<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" type="image/png" href="/static/images/house.png">

	<title>{% block title %}{% endblock %}</title>

    <link href="/static/css/firebase.css" rel="stylesheet">

    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/static/css/template.css" rel="stylesheet">

	<!-- webkit fonts -->
	<script type="text/javascript" src="//use.typekit.net/ykk1qod.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

	<!-- google web fonts -->
	<link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>

	{% block scripts %}{% endblock %}

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
        <div id="fb-root"></div>
    <script>
      window.fbAsyncInit = function() {
        // init the FB JS SDK
        FB.init({
          appId      : '173500369510060',                        // App ID from the app dashboard
          channelUrl : 'http://roomy.herokuapp.com/channel', // Channel file for x-domain comms
          status     : true,                                 // Check Facebook Login status
          xfbml      : true                                  // Look for social plugins on the page
        });
    
        // Additional initialization code such as adding Event Listeners goes here
        FB.Event.subscribe(\'auth.login\', function() {
               window.location.href = "/newUser";
        });
      };
    
      // Load the SDK asynchronously
      (function(){
         // If we've already installed the SDK, we're done
         if (document.getElementById('facebook-jssdk')) {return;}
    
         // Get the first script element, which we'll use to find the parent node
         var firstScriptElement = document.getElementsByTagName('script')[0];
    
         // Create a new script element and set its id
         var facebookJS = document.createElement('script'); 
         facebookJS.id = 'facebook-jssdk';
    
         // Set the new script's source to the source of the Facebook JS SDK
         facebookJS.src = '//connect.facebook.net/en_US/all.js';
    
         // Insert the Facebook JS SDK into the DOM
         firstScriptElement.parentNode.insertBefore(facebookJS, firstScriptElement);
       }());
    </script>

    <div class="navbar navbar-inverse navbar-fixed-top navbar-custom navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
		  <!-- <span class="glyphicon glyphicon-home btn-lg"></span> -->
		  <a class="navbar-brand" href="/">
				  <span class="glyphicon glyphicon-home"></span>&nbsp;&nbsp;&nbsp;
				  <span style="font-weight: bold;">Roomy</span></a>
		  <p class="navbar-text" style="font-size: 16px;">
		  {{ request.session.houseName }}
		  
		  </p>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
				  <li {% if request.path == '/' %} class="active"{% endif %}>
				  <a href="/">HOME</a></li>
				  <li {% if request.path == '/notes/' %} class="active"{% endif %}><a href="/notes/"><span class="glyphicon glyphicon-list-alt"></span>&nbsp;&nbsp;&nbsp;NOTES</a></li>
				  <li {% if request.path == '/chores/' %} class="active"{% endif %}><a href="/chores/"><span class="glyphicon glyphicon-calendar"></span>&nbsp;&nbsp;&nbsp;CHORES</a></li>
				  <li {% if request.path == '/charge/' %} class="active"{% endif %}><a href="/charge/"><span class="glyphicon glyphicon-usd"></span>&nbsp;&nbsp;&nbsp;CHARGES</a></li>
				  {% if request.session.username %}<p class="navbar-text" id="welcome">Welcome, {{ request.session.username}}<a href="/logout" style="font-size: 10px;">(logout){% endif %}</a></p>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">

    </div><!-- /.container -->

	<div class="row">

			<div class="col-md-6 content">
					
				{% if request.session.username or request.path == '/signin'%}
				{% else %}
					<div id="fb-root"></div>
					<script>
					  window.fbAsyncInit = function() {
					  FB.init({
					    appId      : '173500369510060', // App ID
					    channelUrl : 'http://roomy.herokuapp.com/channel', // Channel File
					    status     : true, // check login status
					    cookie     : true, // enable cookies to allow the server to access the session
					    xfbml      : true  // parse XFBML
					  });
					
					  // Here we subscribe to the auth.authResponseChange JavaScript event. This event is fired
					  // for any authentication related change, such as login, logout or session refresh. This means that
					  // whenever someone who was previously logged out tries to log in again, the correct case below 
					  // will be handled. 
					  FB.Event.subscribe('auth.authResponseChange', function(response) {
					    // Here we specify what we do with the response anytime this event occurs. 
					    if (response.status === 'connected') {
					      // The response object is returned with a status field that lets the app know the current
					      // login status of the person. In this case, we're handling the situation where they 
					      // have logged in to the app.
					      testAPI();
					    } else if (response.status === 'not_authorized') {
					      // In this case, the person is logged into Facebook, but not into the app, so we call
					      // FB.login() to prompt them to do so. 
					      // In real-life usage, you wouldn't want to immediately prompt someone to login 
					      // like this, for two reasons:
					      // (1) JavaScript created popup windows are blocked by most browsers unless they 
					      // result from direct interaction from people using the app (such as a mouse click)
					      // (2) it is a bad experience to be continually prompted to login upon page load.
					      FB.login();
					    } else {
					      // In this case, the person is not logged into Facebook, so we call the login() 
					      // function to prompt them to do so. Note that at this stage there is no indication
					      // of whether they are logged into the app. If they aren't then they'll see the Login
					      // dialog right after they log in to Facebook. 
					      // The same caveats as above apply to the FB.login() call here.
					      FB.login();
					    }
					  });
					  };
					
					  // Load the SDK asynchronously
					  (function(d){
					   var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
					   if (d.getElementById(id)) {return;}
					   js = d.createElement('script'); js.id = id; js.async = true;
					   js.src = "//connect.facebook.net/en_US/all.js";
					   ref.parentNode.insertBefore(js, ref);
					  }(document));
					
					  // Here we run a very simple test of the Graph API after login is successful. 
					  // This testAPI() function is only called in those cases. 
					  function testAPI() {
					    FB.api('/me', function(response) {
						var data = {};
						data.name = response.name;
						data.fb_uid = response.id;
						data.image = 'http://graph.facebook.com/' + response.id + '/picture';
						$.post('/createUser', data);
					    });
					  }
					</script>
					
					<!--
					  Below we include the Login Button social plugin. This button uses the JavaScript SDK to
					  present a graphical Login button that triggers the FB.login() function when clicked.
					
					  Learn more about options for the login button plugin:
					  /docs/reference/plugins/login/ -->
					
					<fb:login-button show-faces="true" width="200" max-rows="1"></fb:login-button>

<!--					What's your name?<br>
					<form action='/signin'>
							<input type='text' name='name'>
							<input type='submit' class="btn" value='Go'>
					</form>-->
					{% endif %}
					{% block content %}{% endblock %}</div>
	  
	<div class="col-md-4 col-md-offset-2 feed">
			<div class="text-center feed-header">My Charges</div>
			<br />
			<ul>
					{% for charge in charges|slice:"-5:" reversed %}
					<li {% if forloop.first %}style="padding-top: none;" {% elif forloop.last %}style="padding-bottom: none; border: none;"{% endif %} >
					<span class="glyphicon glyphicon-usd"></span>
							{% for user in charge.users.all %}
									{% if forloop.last %}
											{{ user.name }}
									{% else %}
											{{ user.name }}, 
									{% endif %}
							{% endfor %}
							{% if charge.users.all|length > 1 %}were{% else %}was{% endif %} charged ${{ charge.amount }} for {{charge.note}}
					</li>
					{% endfor %}
			<br />
	</ul>
			<div class="text-center feed-header">My Chores</div>
			<br />
			<ul>
					{% for chore in chores|slice:"-5:" reversed %}
					<li {% if forloop.first %}style="padding-top: none;" {% elif forloop.last %}style="padding-bottom: none; border: none;"{% endif %} >
					<span class="glyphicon glyphicon-asterisk"></span>
							{% for user in chore.users.all %}
									{% if forloop.last %}
											{{ user.name }}
									{% else %}
											{{ user.name }}, 
									{% endif %}
							{% endfor %}
              must do {{ chore.name }} {{ chore.frequency }}
					</li>
					{% endfor %}
			<br />
	</div>

	</div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
  </body>
</html>
